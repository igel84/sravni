o: ActiveSupport::Cache::Entry	:@compressedF:@expires_in0:@created_atf1347389717.5908132:@value{I"
class:EFI"BundledAsset;
FI"id;
F"%a61d460ffa9315f2bcd4ca8a4a68e5ccI"logical_path;
FI"jquery_nested_form.js;
FI"pathname;
FI"|/home/igel/.rvm/gems/ruby-1.9.3-p194@global/gems/bbenezech-nested_form-0.0.6/vendor/assets/javascripts/jquery_nested_form.js;
FI"content_type;
FI"application/javascript;
FI"
mtime;
FI"2012-09-11T22:08:46+04:00;
FI"	body;
FI"‹jQuery(function($) {
  window.NestedFormEvents = function() {
    this.addFields = $.proxy(this.addFields, this);
    this.removeFields = $.proxy(this.removeFields, this);
  };

  NestedFormEvents.prototype = {
    addFields: function(e) {
      // Setup
      var link           = e.currentTarget;
      var assoc          = $(link).attr('data-association');            // Name of child
      var blueprint_name = $(link).attr('data-blueprint_name');         // Blueprint name/id for that association
      var content        = $('#' + blueprint_name).html();              // Fields template
      // Make a unique ID for the new child
      var regexp  = new RegExp('new_' + assoc, 'g');
      var new_id  = new Date().getTime();
      content     = content.replace(regexp, "new_" + new_id);

      // Make the context correct by replacing new_<parents> with the generated ID
      // of each of the parent objects
      var context = ($(link).closest('.fields').find('input:first').attr('name') || '').replace(new RegExp('\[[a-z]+\]$'), '');
      
      // context will be something like this for a brand new form:
      // project[tasks_attributes][new_1255929127459][assignments_attributes][new_1255929128105]
      // or for an edit form:
      // project[tasks_attributes][0][assignments_attributes][1]
      if (context) {
        var parentNames = context.match(/[a-z_]+_attributes/g) || [];
        var parentIds   = context.match(/(new_)?[0-9]+/g) || [];

        for(var i = 0; i < parentNames.length; i++) {
          if(parentIds[i]) {
            content = content.replace(
              new RegExp('(_' + parentNames[i] + ')_.+?_', 'g'),
              '$1_' + parentIds[i] + '_');

            content = content.replace(
              new RegExp('(\\[' + parentNames[i] + '\\])\\[.+?\\]', 'g'),
              '$1[' + parentIds[i] + ']');
          }
        }
      }

      var field = this.insertFields(content, assoc, link);
      $(link).closest("form")
        .trigger({ type: 'nested:fieldAdded', field: field })
        .trigger({ type: 'nested:fieldAdded:' + assoc, field: field });
      return false;
    },
    insertFields: function(content, assoc, link) {
      return $(content).insertBefore(link);
    },
    removeFields: function(e) {
      var link = e.currentTarget;
      var hiddenField = $(link).prev('input[type=hidden]');
      hiddenField.val('1');
      // if (hiddenField) {
      //   $(link).v
      //   hiddenField.value = '1';
      // }
      var field = $(link).closest('.fields');
      field.hide();
      $(link).closest("form").trigger({ type: 'nested:fieldRemoved', field: field });
      return false;
    }
  };

  window.nestedFormEvents = new NestedFormEvents();
  $('form a.add_nested_fields').live('click', nestedFormEvents.addFields);
  $('form a.remove_nested_fields').live('click', nestedFormEvents.removeFields);
});
;
FI"asset_paths;
F[I"|/home/igel/.rvm/gems/ruby-1.9.3-p194@global/gems/bbenezech-nested_form-0.0.6/vendor/assets/javascripts/jquery_nested_form.js;
FI"dependency_paths;
F[{I"	path;
FI"|/home/igel/.rvm/gems/ruby-1.9.3-p194@global/gems/bbenezech-nested_form-0.0.6/vendor/assets/javascripts/jquery_nested_form.js;
FI"
mtime;
FIu:	Timer!€žNë"
:@_zoneI"MSK;
T:nano_numi;:nano_deni:submicro"‚p:offseti@8I"hexdigest;
F"%7b658ad0652107b8ab6a9ffe82ad0030I"_version;
F"%1c9609bc58b1e77c196de29021583379