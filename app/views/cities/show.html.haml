:javascript
  $(document).ready(function() { 
    $('.chzn-select').chosen().change(function() {
      var id = $(this).val();
      document.location.href="/cities/"+id; //http://sravnim-ka.ru
      //alert('sdf')
    });
    $(".chzn-select-deselect").chosen({allow_single_deselect:true}).change(function() {
      var id = $(this).val();
      document.location.href="/cities/#{@city.id}/areas/"+id; //http://sravnim-ka.ru      
    });
    $(".chzn-select-chain").chosen({allow_single_deselect:true}).change(function() {
      var id = $(this).val();
      document.location.href="/cities/#{@city.id}/areas/#{@area == nil ? 1.to_s : @area.id}/chains/"+id; //http://sravnim-ka.ru      
    });   
  });
%legend Таблица сравнения товаров по магазинам города
%br/
= select("city", "id", City.all.collect {|p| [ p.name, p.id ] }, {:include_blank => true}, html_options = {class: 'chzn-select', :'data-placeholder' => "#{@city == nil ? 'Выберите город' : @city.name}"})
- if @city
  = select("area", "name", @city.areas.collect {|p| [ p.name, p.id ] }, {:include_blank => true}, html_options = {class: 'chzn-select-deselect', :'data-placeholder' => "#{@area == nil ? 'Выберите район' : @area.name}"})
- if @area
  = select("chain", "name", Chain.all.collect {|p| [ p.name, p.id ] }, {:include_blank => true}, html_options = {class: 'chzn-select-chain', :'data-placeholder' => "#{@chain == nil ? 'Выберите сеть' : @chain.name}"})
- if current_user && current_user.admin == true && @city != nil && @area != nil && @chain != nil
  %br/
  %br/
  .well{style: "padding:8px;height:30px;margin:0;background:#f9f9f9"}  
    = form_for([@city, @area, @chain, Shop.new(area_id: @area.id, chain_id: @chain.id)], html: {class:"form-inline"}) do |f|
      = f.hidden_field :area_id
      = f.hidden_field :chain_id
      %label.control-label{:for => "shop_adds"} Данные о магазине: 
      = f.text_field :adds, id:'shop_adds', placeholder:"адрес"
      = f.text_field :phone, id:'shop_phone', placeholder:"телефон"
      %button.btn{:type => "submit"} добавить
  %br/
  .well
    %legend список магазинов:
    - Shop.where(area_id: @area.id).where(chain_id: @chain.id).each do |shop|
      = form_for([@city, @area, @chain, shop], html: {class:"form-inline", style:"margin:0;"}) do |f|        
        .controlls          
          = f.text_field :adds, id:'shop_adds', placeholder:"адрес", class:'span5 offset1', style:"margin-top:8px;"
          = f.text_field :phone, id:'shop_phone', placeholder:"телефон", class:'span3', style:"margin-top:8px;"
          .btn-group
            %button.btn.btn-success{:type => "submit", style: 'width:60px;', title: 'сохранить изменения'}
              %i.icon-ok.icon-white
            = link_to [@city, @area, @chain, shop], method: 'delete', confirm: 'вы уверены?', class: 'btn btn-danger btn-pop', style: 'width:30px;', title: 'удалить магазин' do
              %i.icon-trash.icon-white  
%table.table.table-hover.table-striped
  %thead
    %tr
      %th товар
      - 1.upto(7) do |n|
        %th= "магазин " + n.to_s
  %tbody
    - Product.all.each do |product|
      %tr
        %td= product.name
        - 1.upto(7) do |n|
          %td цена
%br/
%blockquote.pull-right
  %p Экономика должна быть экономной
  %small Л. И. Брежнев